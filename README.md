# OpenAI API 密钥验证工具

## 简介

本工具是一个使用 R 语言编写的脚本，用于从指定的网页中提取 OpenAI API 密钥，验证这些密钥的有效性，并检查它们是否支持 `gpt-4o` 模型。验证后的有效密钥将被保存到文件中，方便后续使用。

## 功能

- **自动安装所需包**：如果尚未安装必要的 R 包，脚本将自动安装。
- **代理配置(国内用户)**：支持通过代理进行网络请求，适用于需要通过代理访问外部 API 的用户。
- **提取 API 密钥**：从指定的 URL 列表中提取符合格式的 OpenAI API 密钥。
- **验证密钥有效性**：检查每个密钥是否有效，并确认是否支持 `gpt-4o` 模型。
- **输出结果**：将所有有效且支持 `gpt-4o` 的密钥输出并保存到文件中。

## 安装指南

### 前提条件

- **R 语言环境**：确保已安装 R 语言环境，建议使用最新版本。
- **必要的 R 包**：`httr`, `stringr`, `jsonlite`。脚本会自动检查并安装这些包。

### 安装步骤

1. **克隆或下载脚本**：将本脚本保存为 `validate_keys.R`。

2. **准备目标 URL 列表**：
   - 创建一个名为 `base_url.txt` 的文本文件。
   - 文件中每行包含一个目标 URL，使用制表符 (`\t`) 分隔。例如：
     ```
     https://example.com/page1
     https://example.com/page2
     ```

3. **配置代理（可选）**：
   - 如果需要通过代理访问网络，请在脚本中配置代理设置。
   - 默认代理地址为 `127.0.0.1:7890`，如果代理需要认证，请取消注释相应的代码行，并填写用户名和密码。

## 使用方法

1. **运行脚本**：
   在 R 环境中运行以下命令：
   ```R
   source("validate_keys.R")
   ```
   或者在 RStudio 中打开脚本文件并点击“运行”。

2. **脚本执行流程**：
   - **安装并加载必要的包**。
   - **配置代理**（如果需要）。
   - **读取目标 URL 列表**。
   - **从每个 URL 中提取符合格式的 OpenAI API 密钥**。
   - **验证每个密钥的有效性**：
     - 检查密钥是否有效。
     - 确认密钥是否支持 `gpt-4o` 模型。
   - **输出结果**：
     - 输出找到的有效密钥及其支持情况。
     - 将所有有效且支持 `gpt-4o` 的密钥保存到 `valid_gpt4_keys.txt`。

## 配置代理

如果您的网络环境需要通过代理访问外部网络，请按照以下步骤配置代理：

1. **设置代理地址和端口**：
   ```R
   proxy <- use_proxy(url = "127.0.0.1", port = 7890)
   ```

2. **如果代理需要认证**，请取消注释并填写相应的用户名和密码：
   ```R
   proxy <- use_proxy(url = "127.0.0.1", port = 7890, username = "your_username", password = "your_password")
   ```

## 输出结果

- **控制台输出**：脚本将在控制台输出每个步骤的执行情况，包括找到的密钥数量、验证结果等。
- **保存文件**：所有有效且支持 `gpt-4o` 的密钥将被保存到 `valid_gpt4_keys.txt` 文件中。

## 注意事项

- **速率限制**：为了避免触发 OpenAI 的速率限制，脚本在验证每个密钥后会自动延迟 1 秒。您可以根据需要调整延迟时间。
- **密钥安全**：请妥善保管提取和验证得到的 API 密钥，避免泄露。
- **错误处理**：脚本包含基本的错误处理机制，但在某些异常情况下可能需要手动干预。

## 示例

假设 `base_url.txt` 中包含以下 URL：
```
https://example.com/api_keys_page1
https://example.com/api_keys_page2
```

运行脚本后，输出可能如下：
```
在 https://example.com/api_keys_page1 找到 5 个密钥。
[1] "sk-proj-XXXX" "sk-proj-YYYY" ...
验证密钥： sk-proj-XXXX ...
密钥有效，并支持 gpt-4o。
...
找到 3 个有效且支持 gpt-4o 的密钥：
[1] "sk-proj-XXXX" "sk-proj-ZZZZ" "sk-proj-WWWW"
有效密钥已保存到 'valid_gpt4_keys.txt'
```
